<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />

        <meta name="msapplication-tap-highlight" content="no" />
        <title>Garage Sale Genius</title>

        <!-- from themeroller -->
        <!--
        <link rel="stylesheet" href="themes/sample.min.css" />
        <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
        -->
        
        <link rel="stylesheet" type="text/css" href="css/Roboto.css" />
        <!--<link rel="stylesheet" type="text/css" href="css/gsgenius.css" />-->
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.3.min.css" /> 
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile.iscrollview.css" />
        <link rel="stylesheet" type="text/css" href="css/jquery.mobile.iscrollview-pull.css" />
        <style>
            body {
                font-family: "Roboto";
            }
        </style>
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script type="text/javascript" src="js/jquery-2.1.1.js"></script> 
        <script type="text/javascript" src="js/jquery.mobile-1.4.3.min.js"></script>
        <script type="text/javascript" src="js/jquery.validate.min.js"></script> 
        <script type="text/javascript" src="js/iscroll.js"></script> 
        <script type="text/javascript" src="js/jquery.mobile.iscrollview.js"></script>
        <script type="text/javascript" src="js/jquery.loadJSON.js"></script> 
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/gsgenius.js"></script>

        <script>
            /*
            $(document).on( "mobileinit", function() {
                console.log('mobileinit started.');
                $.mobile.loader.prototype.options.text = "loading";
                $.mobile.loader.prototype.options.textVisible = false;
                $.mobile.loader.prototype.options.theme = "a";
                $.mobile.loader.prototype.options.html = "";
            });
            */
            
            $(document).ready(function(){
                $(document).on({
                    ajaxStart: function() { 
                        //$.mobile.loading('show'); // shows the default jQM loading spinner
                        console.log('Ajax call started.');
                        },
                    ajaxStop: function() {
                        //$.mobile.loading('hide');
                        console.log('Ajax call ended');
                        }    
                });
            });
        </script>
    </head>
    <body>
        <!-- As of jQM 1.4, these have been deprecated
        data-role="content". use role="main" class="ui-content" instead
        data-role="fieldcontain". use class="ui-field-contain" instead
        data-role="button". use  class="ui-btn" instead
        -->

        <!--
        ======================
        REUSABLE OBJECTS BELOW
        ======================
        -->          
    
        

        <!--
        =================
        INTRO PAGES BELOW
        =================
        -->        
                
        <!-- BEGIN PAGE: Select Buy or Sell -->
        <div data-role="page" id="select-buy-or-sell-page">
            <div data-role="header" data-position="fixed">
                <h3>
                    Buy or Sell
                </h3>
            </div>   

            <div role="main" class="ui-content">
                <div class="ui-grid-a">
                    <div class="ui-block-a">
                        <a href="#address-search-criteria-page" data-transition="slide"  class="ui-btn" data-inline="false">
                            <img src="img/buy1.png" alt="buy" width="200px" height="200px" />
                        </a>
                    </div>
                    <div class="ui-block-b">
                        <a href="#enter-seller-item-details-page" data-transition="slide"  class="ui-btn" data-inline="false">
                            <img src="img/buy1.png" alt="sell" width="200px" height="200px" />
                        </a>
                    </div>
                </div>
            </div>

            <div data-role="footer" data-position="fixed" data-tap-toggle="false">
                <h3>Footer</h3>
            </div>    
        </div> 
        <!-- END PAGE: Select Buy or Sell -->
        
        
        <!--
        =================
        BUYER PAGES BELOW
        =================
        -->


        <!-- BEGIN PAGE: Address search criteria -->
        <div data-role="page" id="address-search-criteria-page">
            <div data-role="header" data-position="fixed">
                <h3>Search for Sellers</h3>
            </div>   

             <!-- ajax loading busy indicator popup -->
            <div data-role="popup" id="ajax-modal-popup-address-search" class="ui-corner-all" data-dismissible="false" style="text-align:center; width:200px; height:70px;">
                <div class="box300 border" style="padding:10px;">
                    <img src="img/ajax-loader.gif" style="text-align:left; vertical-align:middle;">
                    Processing
                </div>
            </div> 

            <div role="main" class="ui-content">
                <h3>Search for Garage Sales</h3>
                
                <!--<h4>1. I am coming from: (choose one)</h4>-->
                <h4>1. Enter your location (Postal code, Zip code or Address) or press Get my location</h4>
                <p></p>
                <div class="ui-grid-solo">
                    <div class="ui-block-a">
                        <input type="text" id="buyerlocation" placeholder="Postal code, Zip code or Address"/>
                    </div>
                    <div class="ui-block-a">
                        <!--<input type="button" data-icon="location" value="Use my location" id="usemylocation"/>-->
                        <a id="getmylocation" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-check ui-btn-icon-left ui-btn-a">Get my location</a>
                    </div>
                </div>
                <br/><br/>

                <h4>2. Within how many kilometers from you?</h4>
                <p></p>
                <div class="ui-grid-solo">
                    <div class="ui-block-a" style="width:80%;">
                        <input type="range" name="searchradius" id="searchradius" data-track-theme="a" data-theme="b" min="1" max="20" value="1">
                    </div>
                </div>
                <br/><br/>
                
                <h4>3. Search</h4>
                <p></p>
                <div class="ui-grid-solo">
                    <div class="ui-block-a">
                        <p></p>
                        <p></p>
                        <!--<input type="button" data-icon="search" value="Search" id="searchaddress"/>-->
                        <a id="searchaddress" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-check ui-btn-icon-left ui-btn-a">Search</a>
                    </div>
                </div>
                
            </div>

            <div data-role="footer" data-position="fixed" data-tap-toggle="false">
                <h3>Footer</h3>
            </div>    
        </div> 
        <script type="text/javascript">
    		$(document).on('pageinit', '#address-search-criteria-page', function(){      
                        //alert('pageinit on address-search-criteria-page');

    			$(document).on('click', '#usemylocation', function(){

    				if (navigator.geolocation) {
    					function success(pos) {
    						// Location found
    						alert((new google.maps.LatLng(pos.coords.latitude, pos.coords.longitude)));
    					}
    					function fail(error) {
    						alert("Cannot determine your location.");
    					}
    					// Find the users current position.  Cache the location for 5 minutes, timeout after 6 seconds
    					navigator.geolocation.getCurrentPosition(success, fail, {maximumAge: 500000, enableHighAccuracy:true, timeout: 6000});
    				}
    			});

    			$(document).on('click', '#searchaddress', function(){ 

    			    var url = 'http://winskee.com/phonegap/garagesalegenius/get-active-garage-sales.php'; 

                    $.ajax({
                        url: url,
                        async: true,
                        beforeSend: function() {
                            //$.mobile.loading('show', {theme:"a", text:"Getting addresses...", textonly:false, textVisible: true}); // show AJAX spinner
                            $('#ajax-modal-popup-address-search').popup("open");
                        },
                        complete: function() {
                            $('#ajax-modal-popup-address-search').popup("close");   
                        },  
                        success: function (result) {
                            ajax.parseJSONP(result);
                        },
                        error: function (request,error) {
                            alert("Can't seem to reach our servers.  Is your internet connection OK?  Please try again!");
                        }
                    });         
    			});        
    		});
    		var sellersVO = {
    			id : null,
    			sellers : null,
                sellerDetail: null
    		}
    		var ajax = {  
    			parseJSONP:function(result) {  
    				sellersVO.sellers = result;
                    console.log('Addresses found: ' + sellersVO.sellers);

    				// show the results page
    				$(':mobile-pagecontainer').pagecontainer('change', '#address-search-results-page', {
    				    reload: false
    				});

    			}
    		}
        </script>
        <!-- END PAGE: Address search criteria -->

        
        <!-- BEGIN PAGE: Address search results -->
        <div data-role="page" id="address-search-results-page">
            <div data-role="header" data-position="fixed">
                <h3>
                    Address search results
                </h3>
                <a href="#address-search-results-map-page" data-icon="navigation" class="ui-btn-right">View in map</a>
            </div>   

            <div role="main" class="ui-content">
                <div class="listview-wrapper" data-iscroll>
                    <ul data-role="listview" id="address-list" data-inset="true" data-icon="false">
                    </ul>
                </div>
            </div>

            <div data-role="footer" data-position="fixed" data-tap-toggle="false">
                <h3>Footer</h3>
            </div>    
        </div> 
        <script type="text/javascript">
            $(document).on('pageinit', '#address-search-results-page', function(){
                //alert('pageinit on address-search-results-page');
                // populate search results
                $('#address-list').empty();        
                $.each(sellersVO.sellers, function(i, row) {

                    // append the gui_selected attribute that we will use to store the user's selection of this address
                    row.gui_selected = false;
                    console.log('Seller: ' + JSON.stringify(row));

                    // assemble the custom address row
                    var addressStaticGMapUrl = 'http://maps.googleapis.com/maps/api/staticmap?center=' + row.latitude + ',' + row.longitude + '&zoom=17&size=100x100&maptype=roadmap&markers=' + row.latitude + ',' + row.longitude;

                    $('#address-list').append('<li><a href="" data-id="' + row.id + '">' + '<img src="' + addressStaticGMapUrl + '"/>'  + '<h3>' + row.formatted_address + '</h3><p>When:&nbsp;' + row.start_time + '&nbsp;-&nbsp;' + row.end_time + '</p></a></li>');
                });
                $('#address-list').listview('refresh');
                $(".listview-wrapper").iscrollview("refresh");

                // click on a search item result
                $(document).on('vclick', '#address-list li a', function(){  
                    sellersVO.id = $(this).attr('data-id');

                    $.each(sellersVO.sellers, function(i, row) {
                        // toggle select/deselect address
                        if (row.id == sellersVO.id) {
                            sellersVO.sellerDetail = row;   // keep a reference to the selected address
                            if (row.gui_selected) {
                                row.gui_selected = false;
                                console.log("Deselected " + row.formatted_address);
                            } else {
                                row.gui_selected = true;
                                console.log("Selected " + row.formatted_address);
                            }
                            return false;   // exit loop                            
                        }

                    });

                    //$(this).attr('data-theme','a').trigger('refresh');
                    $(':mobile-pagecontainer').pagecontainer('change', '#view-seller-item-details-page', {
                        reload: false
                    });
                });
            });
        </script>
        <!-- END PAGE: Address search results -->


        <!-- BEGIN PAGE: Address search results in map -->
        <div data-role="page" id="address-search-results-map-page">
            <div data-role="header" data-position="fixed">
                <h3>
			Search results in map
                </h3>
                <a href="#address-search-results-map-page" data-icon="navigation" class="ui-btn-left" data-rel="back">Back</a>
            </div>   

            <div data-role="content" id="search-results-map-div">
                <div id="search-results-map-canvas" style="height:100%"></div>
            </div>

            <div data-role="footer" data-position="fixed" data-tap-toggle="false">
                <h3>Footer</h3>
            </div>    
        </div> 
        <script>
            $(document).on('pageshow', '#address-search-results-map-page',function(e,data) {   
                $('#search-results-map-div').height(getRealContentHeight());
                // This is the minimum zoom level that we'll allow
                var minZoomLevel = 12;

                var map = new google.maps.Map(document.getElementById('search-results-map-canvas'), {
                    zoom: minZoomLevel,
                    center: new google.maps.LatLng(38.50, -90.50),
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    panControl: true,
                    mapTypeControl: false,
                    panControlOptions: {
                        position: google.maps.ControlPosition.RIGHT_CENTER
                    },
                    zoomControl: true,
                    zoomControlOptions: {
                        style: google.maps.ZoomControlStyle.LARGE,
                        position: google.maps.ControlPosition.RIGHT_CENTER
                    },
                    scaleControl: false,
                    streetViewControl: true,
                    streetViewControlOptions: {
                        position: google.maps.ControlPosition.RIGHT_CENTER
                    }
                });

                var bounds = new google.maps.LatLngBounds();
                $.each(sellersVO.sellers, function(i, row) {
                    var latlng = new google.maps.LatLng(row.latitude, row.longitude);
                    new google.maps.Marker({
                        position: latlng,
                        map: map
                    });
                    bounds.extend(latlng);

                });
                map.fitBounds(bounds);

            });
        </script>
        <!-- END PAGE: Address search results in map -->
        
        
        
        <!--
        ==================
        SELLER PAGES BELOW
        ==================
        -->

        <!-- BEGIN PAGE: Email explanation -->
        <!-- END PAGE: Email explanation -->
        
        
        <!-- BEGIN PAGE: Enter Seller item details -->
        <div data-role="page" id="enter-seller-item-details-page">
            <form id="seller-form1">
                <div data-role="header" data-position="fixed">
                    <h3>Sell</h3>
                </div>   

                <!-- A popup div has to be nested inside the same page as the link! -->
                <div data-role="popup" id="why-email-is-required" class="ui-content" data-theme="b" data-dismissible="false">
                    <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
                    <h4>Why do I need to provide my email?</h4>
                    <p>
                        Upon submitting this form, an email will be sent to you which contains a link to approve and activate this garage sale.<br/>
                        This ensures that no other individual can post a Garage Sale with your address without your knowledge and approval.
                    </p>
                    <br/>
                    <h4>Our Email Guarantee</h4>
                    <p>
                        Your email will be used for the sole purpose of sending you the link to activate this Garage Sale.<br/>
                        We will never, ever sell, distribute nor contact you for any other purposes other than sending you the activation link.
                    </p>
                </div>

                 <!-- ajax loading busy indicator popup -->
                <div data-role="popup" id="ajax-modal-popup-save-new-address" class="ui-corner-all" data-dismissible="false" style="text-align:center; width:200px; height:70px;">
                    <div class="box300 border" style="padding:10px;">
                        <img src="img/ajax-loader.gif" style="text-align:left; vertical-align:middle;">
                        Processing
                    </div>
                </div> 
              
                <div role="main" class="ui-content">
                    <h3>Enter your Garage Sale details</h3>
                        <div class="ui-field-contain">
                            <div>
                                Email:<a href="#why-email-is-required" data-rel="popup">Info</a>
                            </div>
                            <input type="email" name="email" id="email" placeholder="Enter your email"/>
                        </div>
                        <div class="ui-field-contain">
                            <label for="address">Address:</label>
                            <input type="text" id="address" name="address" placeholder="Enter your address"/>
                        </div>
                        <div class="ui-field-contain">
                            <label for="starttime">Start Time:</label>
                            <input type="text" id="starttime" name="starttime" placeholder="Enter Start Time"/>
                        </div>
                        <div class="ui-field-contain">
                            <fieldset data-role="controlgroup">
                                <legend>Select all that apply to your Garage Sale:</legend>

                                <label for="multifamily">Multi-Family</label>
                                <input type="checkbox" name="multifamily" id="multifamily" value="N">
                                <label for="parkonstreet">Park on Street</label>
                                <input type="checkbox" name="parkonstreet" id="parkonstreet" value="N">
                                <label for="parkatvisitorsparking">Park at Visitors Parking</label>
                                <input type="checkbox" name="parkatvisitorsparking" id="parkatvisitorsparking" value="N">	
                                <label for="earlybirdsspecial">Early Birds Specials available</label>
                                <input type="checkbox" name="earlybirdsspecial" id="earlybirdsspecial" value="N">	
                                <label for="canceledwhenraining">Cancelled when raining</label>
                                <input type="checkbox" name="canceledwhenraining" id="canceledwhenraining" value="N">	
                                <label for="cashonly">Cash only</label>
                                <input type="checkbox" name="cashonly" id="cashonly" value="cashonly">	
                                <label for="refreshementsprovided">Simple refreshments provided</label>
                                <input type="checkbox" name="refreshementsprovided" id="refreshementsprovided" value="N">	
                                <label for="surprisefreebies">Surprise Freebies available</label>
                                <input type="checkbox" name="surprisefreebies" id="surprisefreebies" value="N">	
                                <label for="collectorsitems">Collector's Items</label>
                                <input type="checkbox" name="collectorsitems" id="collectorsitems" value="N">	
                                <input type="hidden" name="source" id="source" value="MOBILEAPP" />
                                <input type="hidden" name="sellerlatitude" id="sellerlatitude" />
                                <input type="hidden" name="sellerlongitude" id="sellerlongitude" />
                                <input type="hidden" name="formattedaddress" id="formattedaddress" />
                            </fieldset>
                        </div>
                        <div class="ui-field-contain">
                            <label for="messagetobuyers">Additional message to buyers:</label>
                            <textarea id="messagetobuyers" name="messagetobuyers" placeholder="eg: Specify your specialty items"></textarea>
                        </div>
                </div>

                <div data-role="footer" data-position="fixed" data-tap-toggle="false">
                    <input type="button" data-icon="delete" value="Cancel" id="cancel"/>    
                    <input type="submit" data-icon="check" value="Submit" id="submit"/>
                </div>
            </form>

        </div> 

        <script>
            $('#seller-form1').validate({
                rules: {
                    address: {
                        required: true
                    },
                    email: {
                        required: true
                    }
                },
                messages: {
                    address: {
                        required: "Please enter your address."
                    },
                    email: {
                        required: "Please enter your email."
                    }
                },
                errorPlacement: function (error, element) {
                    error.appendTo(element.parent().prev());
                    /*error.insertAfter( element.parent() );*/
                },
                submitHandler: function (form) {
                    // geocode the seller's address
                    var geocoder = new google.maps.Geocoder();
                    var addressToGeoCode = $("#address").val();
                    
                    // geocoding is async
                    // submit the seller form only when the address is valid
                    geocoder.geocode({'address': addressToGeoCode}, function(results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {

                            /*
                            mysql data type
                            Latitudes range from -90 to +90 (degrees), so DECIMAL(10, 8) is ok for that, but longitudes range from -180 to +180 (degrees) so you need DECIMAL(11, 8). The first number is the total number of digits stored, and the second is the number after the decimal point.

                            In short: lat DECIMAL(10, 8) NOT NULL, lng DECIMAL(11, 8) NOT NULL
                            */

                            $('#sellerlatitude').val(results[0].geometry.location.lat());
                            $('#sellerlongitude').val(results[0].geometry.location.lng());
                            $('#formattedaddress').val(results[0].formatted_address);
                            console.log('formatted address: ' + results[0].formatted_address);

                            // submit the seller form
                            $.ajax({
                                url: 'http://winskee.com/phonegap/garagesalegenius/add-garage-sale.php', 
                                type: 'POST', 
                                dataType: 'json', // request type html/json/xml
                                data: $('#seller-form1').serialize(), 
                                beforeSend: function() {
                                    $('#ajax-modal-popup-save-new-address').popup("open");
                                },
                                complete: function() {
                                    $('#ajax-modal-popup-save-new-address').popup("close");
                                },
                                success: function(data) {
                                    // show the success page
                                    $(':mobile-pagecontainer').pagecontainer('change', '#thank-you-for-posting-page', {
                                        reload: false
                                    });
                                },
                                error: function(e) {
                                    console.log(e)
                                }
                            });

                        } else {
                            alert('Geocode was not successful for the following reason: ' + status);
                        }
                    });
                    
                    return false;
                }

            });
        </script>
        <!-- END PAGE: Enter Seller item details -->


        <!-- BEGIN PAGE: Confirm add Seller item details popup -->
        <!--
        <a href="#popupDialog" data-rel="popup" data-position-to="window" data-transition="pop" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-delete ui-btn-icon-left ui-btn-b">Confirm Garage Sale</a>
        <div data-role="popup" id="popupDialog" data-overlay-theme="b" data-theme="b" data-dismissible="false" style="max-width:400px;">
            <div data-role="header" data-theme="a">
                <h1>Delete Page?</h1>
            </div>
            <div role="main" class="ui-content">
                <h3 class="ui-title">Are you sure you want to delete this page?</h3>
                <p>This action cannot be undone.</p>
                <a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back">Cancel</a>
                <a href="#" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-btn-b" data-rel="back" data-transition="flow">Delete</a>
            </div>
        </div>
        -->
        <!-- BEGIN PAGE: Confirm add Seller item details popup -->

        
        <!-- BEGIN PAGE: View Seller item details -->
        <div data-role="page" id="view-seller-item-details-page">
            <form id="ro-seller-form1">
                <div data-role="header" data-position="fixed">
                    <h3>Seller's Info</h3>
                </div>   
                
                <!-- prompt for buyer address popup -->
                <div data-role="popup" id="buyer-address-popup" data-theme="a" class="ui-corner-all" data-dismissible="false">
                    <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
                    <div style="padding:10px 20px;text-align: center;">
                        <h3>Enter your address or location</h3>
                        <label for="buyer_address" class="ui-hidden-accessible">Address:</label>
                        <input type="text" name="buyer_address" id="buyer_address" value="" placeholder="" data-theme="a">
                        <button class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-btn-icon-left ui-icon-check ui-btn-inline" onclick="geoCodeBuyerAddress();">Go!</button>
                    </div>
                </div>

                <div role="main" class="ui-content">
                    <h3 id="ro_address"></h3>
                    <h4 id="ro_start_time"></h4>
                    <div id="ro_message">Message from seller: </div>
                    <p></p>

                    <div id="ro_multi_family" style="display:none;">Multi-Family&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div>
                    <div id="ro_street_parking" style="display:none;">Park on Street&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div>
                    <div id="ro_visitors_parking" style="display:none;">Park at Visitors Parking&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div>
                    <div id="ro_early_bird" style="display:none;">Early Birds Specials available&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div>
                    <div id="ro_rain_cancelled" style="display:none;">Cancelled when raining&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div> 
                    <div id="ro_cash_only" style="display:none;">Cash only&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div>
                    <div id="ro_refreshments" style="display:none;">Simple refreshments provided&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div>
                    <div id="ro_freebies" style="display:none;">Surprise freebies available&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div>
                    <div id="ro_collectors_items" style="display:none;">Collector's Items&nbsp;<img src="img/checkmark1.png" width="36px" height="36px"/></div>
                    
                    <!-- buyer to seller map and directions -->
                    <div style="width:100%; padding-top:10px;">
                        <h3 id="map-and-directions-header" style="display:none; float:left;margin-right:10px;">Map and Driving directions to Seller's location</h3>
                        <!--
                        <input type="button" data-icon="location" data-inline="true" value="Get Driving Directions" id="get-driving-directions" style="float:right;"/>
                        -->
                        <a id="get-driving-directions" href="#buyer-address-popup" data-rel="popup" data-position-to="window" class="ui-btn ui-corner-all ui-shadow ui-btn-inline ui-icon-check ui-btn-icon-left ui-btn-a" data-transition="pop">Get Driving Directions</a>
                    </div>

                    <!--
                    <div id="b2s-map-div" style="width:100%;clear:left;">
                        <div id="b2s-map-canvas" style="width:48%; height:100%;; border: 1px solid silver; float:left;"></div>
                        <div id="b2s-directions-panel" style="width:48%; height:100%; float:right;"></div>
                    </div>
                    -->

                    <!-- map and driving directions tabbed interface -->
                    <div data-role="tabs" id="b2s-map-div" style="width:100%; clear:left; margin-top:10px;">
                        <div data-role="navbar">
                            <ul>
                                <li><a id="map-tab" href="#fragment-map">Map</a></li>
                                <li><a href="#fragment-directions">Driving Directions</a></li>
                            </ul>
                        </div>
                        <div id="fragment-map" style="height:360px;">
                            <div id="b2s-map-canvas" style="width:100%; height:100%;"></div>
                        </div>
                        <div id="fragment-directions">
                            <!-- google map directions from buyer to seller's location -->
                            <div id="b2s-directions-panel" style="width:100%; height:100%;"></div>
                        </div>
                    </div>
                    
                </div>

                <div data-role="footer" data-position="fixed" data-tap-toggle="false">
                    <input type="button" data-icon="delete" value="Cancel" id="cancel"/>    
                    <input type="submit" data-icon="check" value="Submit" id="submit"/>
                </div>
            </form>
        </div> 

        <script>
            // legend: b2s = buyer to seller
            var b2sDirectionsDisplay = new google.maps.DirectionsRenderer();
            var b2sDirectionsService = new google.maps.DirectionsService();
            var b2sMap;
            var b2sDrivingDirectionsRequest;
            
            $(document).on('pageshow', '#view-seller-item-details-page',function(e,data) {
                // set and display the seller's detail info
                
                /* couldn't get it to work for checkboxes, even though JSON object contains boolean values
                console.log('Populating seller form from JSON: ' + JSON.stringify(sellersVO.sellerDetail));
                $('form').loadJSON(sellersVO.sellerDetail); // the name of the read-only form is ro-seller-form1, but it seems 'form' must be passed in.
                */
                
                console.log('Populating seller form from JSON: ' + JSON.stringify(sellersVO.sellerDetail));
                $('#ro_address').html(sellersVO.sellerDetail.formatted_address);
                $('#ro_start_time').html(sellersVO.sellerDetail.start_time);
                $('#ro_message').html('Message from seller: ' + sellersVO.sellerDetail.message);
                (sellersVO.sellerDetail.multi_family)? $('#ro_multi_family').show() : $('#ro_multi_family').hide();
                (sellersVO.sellerDetail.street_parking)? $('#ro_street_parking').show() : $('#ro_street_parking').hide();
                (sellersVO.sellerDetail.visitors_parking)? $('#ro_visitors_parking').show() : $('#ro_visitors_parking').hide();
                (sellersVO.sellerDetail.early_bird)? $('#ro_early_bird').show() : $('#ro_early_bird').hide();
                (sellersVO.sellerDetail.rain_cancelled)? $('#ro_rain_cancelled').show() : $('#ro_rain_cancelled').hide();
                (sellersVO.sellerDetail.cash_only)? $('#ro_cash_only').show() : $('#ro_cash_only').hide();
                (sellersVO.sellerDetail.refreshments)? $('#ro_refreshments').show() : $('#ro_refreshments').hide();
                (sellersVO.sellerDetail.freebies)? $('#ro_freebies').show() : $('#ro_freebies').hide();
                (sellersVO.sellerDetail.collectors_items)? $('#ro_collectors_items').show() : $('#ro_collectors_items').hide();
        
                console.log('Rendering buyer to seller map');
                $('#b2s-map-div').height(getRealContentHeight() / 2);   // TODO: need to know what height to set the div to, and not just guessing

                // initially, source and destination latlngs are the same
                b2sDrivingDirectionsRequest = {
                    origin: new google.maps.LatLng(sellersVO.sellerDetail.latitude, sellersVO.sellerDetail.longitude),
                    destination: new google.maps.LatLng(sellersVO.sellerDetail.latitude, sellersVO.sellerDetail.longitude),
                    travelMode: google.maps.TravelMode.DRIVING
                };
                
                initBuyer2SellerMapAndDrivingDirections(false);

            });
            
            var initBuyer2SellerMapAndDrivingDirections = function(includeDrivingDirections) {
                console.log('Initializing buyer to seller map and driving directions.');
                // create the buyer to seller map
                b2sMap = new google.maps.Map(document.getElementById('b2s-map-canvas'), {
                    zoom: 15,
                    center: new google.maps.LatLng(sellersVO.sellerDetail.latitude, sellersVO.sellerDetail.longitude),
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    panControl: false,
                    mapTypeControl: false,
                    panControlOptions: {
                        position: google.maps.ControlPosition.RIGHT_CENTER
                    },
                    zoomControl: false,
                    zoomControlOptions: {
                        style: google.maps.ZoomControlStyle.LARGE,
                        position: google.maps.ControlPosition.RIGHT_CENTER
                    },
                    scaleControl: false,
                    streetViewControl: false,
                    streetViewControlOptions: {
                        position: google.maps.ControlPosition.RIGHT_CENTER
                    }
                });

                if (includeDrivingDirections) {
                    // get driving directions from buyer to seller
                    // show map and directions from buyer to seller
                    console.log('Calling DirectionsService.route...');
                    b2sDirectionsService.route(b2sDrivingDirectionsRequest, function(response, status) {
                        if (status == google.maps.DirectionsStatus.OK) {
                            console.log('Got the directions.');
                            b2sDirectionsDisplay.setMap(b2sMap);
                            $('#b2s-directions-panel').html('');    // clear previous directions
                            b2sDirectionsDisplay.setPanel(document.getElementById('b2s-directions-panel'));
                            b2sDirectionsDisplay.setDirections(response);

                            // increase map height if needed
                            var directionsDivHeight = $('#b2s-directions-panel').outerHeight(true);
                            var mapCanvasHeight = $('#b2s-map-canvas').outerHeight(true);
                            /*
                            if (mapCanvasHeight < directionsDivHeight) {
                                //$('#b2s-map-canvas').height(directionsDivHeight);
                                $('#b2s-map-div').equalHeights();
                            }
                            */
                        } else {
                            console.log('Failed to get the directions. status = ' + status);
                            $('#b2s-directions-panel').html("Sorry, no driving route found!  Map displays the seller's address.");

                            console.log("Displaying the seller's address on the map.");
                            var bounds = new google.maps.LatLngBounds();
                            //var latlng = new google.maps.LatLng(b2sDrivingDirectionsRequest.destination);
                            var latlng = new google.maps.LatLng(sellersVO.sellerDetail.latitude, sellersVO.sellerDetail.longitude);
                            new google.maps.Marker({
                                position: latlng,
                                map: b2sMap
                            });
                            bounds.extend(latlng);
                            b2sMap.fitBounds(bounds);

                        }
                    });
                } else {
                    // by default, show the seller's marker on the map
                    console.log('Placing map marker for ' + sellersVO.sellerDetail.formatted_address);
                    var latlng = new google.maps.LatLng(sellersVO.sellerDetail.latitude, sellersVO.sellerDetail.longitude);
                    new google.maps.Marker({
                        position: latlng,
                        map: b2sMap
                    });
                    $('#b2s-directions-panel').html("<br>Press Get Driving Directions to get driving directions to the seller's address.");
                }   // end if (includeDrivingDirections) {
                
                $("#map-tab").trigger("click");

            }   // end var initBuyer2SellerMapAndDrivingDirections

            var geoCodeBuyerAddress = function() {
                $("#buyer-address-popup").popup("close");
                buyerAddressToGeoCode = $("#buyer_address").val();
                
                // actually, no need to geocode the buyer's address, as the driving directions request object can take either latlng or address string
                //console.log('Geocoding buyer address: ' + buyerAddressToGeoCode);

                b2sDrivingDirectionsRequest = {
                    origin: buyerAddressToGeoCode,
                    destination: new google.maps.LatLng(sellersVO.sellerDetail.latitude, sellersVO.sellerDetail.longitude),
                    travelMode: google.maps.TravelMode.DRIVING
                };

                initBuyer2SellerMapAndDrivingDirections(true);
            }

        </script>
        <!-- END PAGE: View Seller item details -->
        

        <!-- BEGIN PAGE: Thank you for posting -->
        <div data-role="page" id="thank-you-for-posting-page">
            <div data-role="header" data-position="fixed">
                <h3>
			Buy or Sell
                </h3>
            </div>   

            <div role="main" class="ui-content post-thank-you">
                Thank You!<p></p>
                Your garage sale is now posted.<p></p>
                Good luck!<p></p>
                Please tell your friends about this app!  
            </div>

            <div data-role="footer" data-position="fixed" data-tap-toggle="false">
                <h3>Footer</h3>
            </div>    
        </div> 
        <!-- END PAGE: Enter Address or Get my location page -->



    </body>
</html>
